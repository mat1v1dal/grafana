global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ── IAIARS API replicas (per-worker monitoring) ──────────────────────────
  # Each replica registers its Railway IPv6 address in Redis on startup.
  # The /health/metrics/targets endpoint reads Redis and returns all replicas
  # in Prometheus HTTP SD format. Prometheus scrapes each IPv6 directly via
  # socat (IPv6 → IPv4 bridge running in each replica container).
  #
  # Set IAIARS_PRIVATE_DOMAIN and IAIARS_PORT in this service's Railway env vars.
  - job_name: 'iaiars-api-replicas'
    http_sd_configs:
      - url: 'http://${IAIARS_PRIVATE_DOMAIN}:${IAIARS_PORT}/health/metrics/targets'
        refresh_interval: 30s
    metrics_path: '/metrics'
    scheme: 'http'
    scrape_interval: 15s
    scrape_timeout: 10s
