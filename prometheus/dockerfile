ARG VERSION=v3.2.1

FROM prom/prometheus:${VERSION}

# Install gettext for envsubst (env-variable substitution in prom.yml)
USER root
RUN apk add --no-cache gettext

# Copy config as template
COPY prom.yml /etc/prometheus/prom.yml.template

# Entrypoint: substitute env vars then start Prometheus
CMD ["sh", "-c", "envsubst < /etc/prometheus/prom.yml.template > /etc/prometheus/prom.yml && prometheus --config.file=/etc/prometheus/prom.yml --storage.tsdb.path=/prometheus"]
